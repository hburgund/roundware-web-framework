<html>
  <head>
    <title>RoundwareWebListen Test</title>
  </head>
  <body>
    <script type="text/javascript" src="roundware.umd.js"></script>
    <script type="text/javascript" src="jquery-3.2.1.slim.min.js"></script>
    <script>
      /* 
        To run this example, execute "npm run devserver && open localhost:8080" from the project root directory -->
        You also need to have the Roundware Server running locally, see https://github.com/roundware/roundware-server#vagrant 
      */

      var roundwareServerUrl = "http://localhost:8888/api/2";
      var roundwareProjectId = 1; // corresponds to a project setup in the roundware server developer seed script

      var roundware = new Roundware({
        serverUrl: roundwareServerUrl,
        projectId: roundwareProjectId
      });

      function handleListening(streamURL) {
        var streamPlayer = $("#streamplayer");
        var audioSource  = $("#audiosource");
        var pauseButton  = $("#pause");

        console.info("Starting to listen to " + streamURL);
        audioSource.prop("src",streamURL);

        streamPlayer.trigger("load");
        streamPlayer.trigger("play");

        pauseButton.show();

        pauseButton.click(function() {
          console.info("pausing");
          streamPlayer.trigger("pause");
        }).show();
      };

      // Generally we throw user-friendly messages and log a more technical message
      function handleListeningFailure(userErrMsg) {
        console.error("Roundware Start Error",userErrMsg);
      };

      $(function startApp() {
        roundware.start().
          then(handleListening).
          catch(handleListeningFailure);

        var tagIds = $("#tag_ids");
        
        tagIds.change(function(evt) {
          roundware.tags(tagIds.val().join(","));
        });
      });
    </script>

    <audio id="streamplayer" style="border: solid 1px black;">
      <source id="audiosource" type="audio/mp3"></source>
      Your browser does not support the audio format.
    </audio>

    <h1 id='status'>...</h1>
    <button id="pause" style="display: none;">Pause</button>
    <div>
      <label>Tag IDs</label>
      <input id='tag_ids' />
    </div>

    <p>Also check out our <a href="https://subelsky.github.io/roundware_web_demo/">live demo</a> using a recent build&ellip;p>
  </body>
</html>
