<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: api-client.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: api-client.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { logger } from "./shims";

var jQuery = require('jquery');

// Handles HTTP interactions with the Roundware API server, v2.
// NOTE: Every HTTP method except ".get()" will cause most browers to issue a preflight requirements check to the server via the OPTIONS verb, 
// to verify CORS will allow the response to load in the browser. Sometimes this OPTIONS call can get obscured in debugging tools.
// @see http://roundware.org/docs/terminology/index.html
export class ApiClient {
  constructor(baseServerUrl,options = {}) {
    this._serverUrl = baseServerUrl;
    this._ajaxInterface = options.ajaxInterface || jQuery;
  }

  get(path,data,options = {}) {
    options.method = "GET";
    return this.send(path,data,options);
  }

  post(path,data,options = {}) {
    options.method = "POST";
    return this.send(path,data,options);
  }

  patch(path,data,options = {}) {
    options.method = "PATCH";
    return this.send(path,data,options);
  }

  /** Transmit an Ajax request to the Roundware API. Note that the Roundware Server expects paths to end with a trailing slash: /sessions/ instead of /sessions
   * @param path {string} - identifies the endpoint to receive the request
   * @param data {object} - the payload to send
   * @param options {object} - any additional options to add to the Ajax request 
   * @throws Will throw user-friendly error message and a technical error message in the event of an unsuccessful request 
   * @todo might be a good place to implement exponential retry of certain types of errors
   * **/
  send(path,data,options = {}) {
    var url = this._serverUrl + path;

    options.data = data;
    options.crossDomain = true;

    let requestPromise = this._ajaxInterface.ajax(url,options);

    let errorHandlingRequestPromise = requestPromise.catch((xhr,textStatus,errorThrown) => {
      // We catch and rethrow the error so it can bubble up as a useful error message to the user
      let techMsg = `API connection problem: '${textStatus}'; error thrown: (${errorThrown})`;
      logger.error(techMsg);

      let usrMsg = "We were unable to contact the audio server. Please try again.";
      throw(usrMsg);
    });

    return errorHandlingRequestPromise;
  }

  setAuthToken(authToken) {
    var headers = {
      Authorization: "token " + authToken
    };

    this._ajaxInterface.ajaxSetup({
      headers: headers
    });
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="GeoPosition.html">GeoPosition</a></li><li><a href="module.exports.html">exports</a></li><li><a href="Session.html">Session</a></li><li><a href="Stream.html">Stream</a></li><li><a href="User.html">User</a></li></ul><h3>Global</h3><ul><li><a href="global.html#connect">connect</a></li><li><a href="global.html#pause">pause</a></li><li><a href="global.html#play">play</a></li><li><a href="global.html#tags">tags</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Sun Jun 18 2017 10:31:53 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
