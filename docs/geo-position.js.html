<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: geo-position.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: geo-position.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { logger } from "./shims";

const initialGeoTimeoutSeconds = 1;

const defaultCoords = {
  latitude: 1,
  longitude: 1
};

// for an initial rapid, low-accuracy position
const fastGeolocationPositionOptions = { 
  enableHighAccuracy: false,
  timeout: initialGeoTimeoutSeconds
};

// subsequent position monitoring should be high-accuracy
const accurateGeolocationPositionOptions = { 
  enableHighAccuracy: true
};

/** Responsible for tracking the user's position, when geo listening is enabled and the browser is capable
 * @property {Boolean} geoListenEnabled - whether or not the geo positioning system is enabled and available
 * @see https://developer.mozilla.org/en-US/docs/Web/API/Geolocation/Using_geolocation **/
export class GeoPosition {
  /** Create a new GeoPosition.
   * @param {Object} navigator - provides access to geolocation system
   * @param {Object} options - parameters for initializing this GeoPosition
   * @param {Boolean} [options.geoListenEnabled = false] - whether or not to attempt to use geolocation **/
  constructor(navigator,options = {}) {
    this._navigator = navigator;
    this._initialGeolocationPromise = Promise.resolve(defaultCoords);

    if (this._navigator.geolocation &amp;&amp; options.geoListenEnabled) {
      this.geoListenEnabled = true;
    } else {
      this.geoListenEnabled = false;
    }
  }

  /** @return {String} Human-readable representation of this GeoPosition **/
  toString() { 
    return `GeoPosition (enabled: ${this.geoListenEnabled})`;
  }

  /** Attempts to get an initial rough geographic location for the listener, then sets up a callback
   * to update the position.
   * @param {Function} geoUpdateCallback - object that should receive geolocation coordinate updates
   * @see geoListenEnabled **/
  connect(geoUpdateCallback = () => {}) {
    if (!this.geoListenEnabled) {
      logger.info("Geolocation disabled");
      this._initialGeolocationPromise = Promise.resolve({});
      return;
    }

    logger.info("Initializing geolocation system");

    this._initialGeolocationPromise = new Promise((resolve,reject) => {
      this._navigator.geolocation.getCurrentPosition((initialPosition) => {
        let coords = initialPosition.coords;
        logger.info("Received initial geolocation",coords);
        geoUpdateCallback(coords);

        let geoWatchId = this._navigator.geolocation.watchPosition((updatedPosition) => {
          let newCoords = updatedPosition.coords;
          geoUpdateCallback(newCoords);
        },(error) => {
          logger.warn(`Unable to watch position: ${error.message} (code #${error.code})`);
        },accurateGeolocationPositionOptions);

        logger.info(`Monitoring geoposition updates (watch ID ${geoWatchId})`);
        resolve(coords);
      },function initialGeoError(error) {
        logger.warn(`Unable to get initial geolocation: ${error.message} (code #${error.code})`);
        resolve(defaultCoords);
      },fastGeolocationPositionOptions);
    });
  }

  /** Allows you to wait on the progress of the .connect() behavior, attempting to get an initial
   * estimate of the user's position. Note that this promise will never fail - if we cannot get an
   * accurate estimate, we fall back to default coordinates (currently latitude 1, longitude 1)
   * @return {Promise} Represents the attempt to get an initial estimate of the user's position **/
  waitForInitialGeolocation() {
    return this._initialGeolocationPromise;
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ApiClient.html">ApiClient</a></li><li><a href="GeoPosition.html">GeoPosition</a></li><li><a href="Roundware.html">Roundware</a></li><li><a href="Session.html">Session</a></li><li><a href="Stream.html">Stream</a></li><li><a href="User.html">User</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed Jun 28 2017 16:49:43 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
